## 实战 - 歌词滚动效果



### 资源

- 歌曲MP4
- 歌词字符串文本 [时间点]每个时间点歌词



### 网站图标

使用 `link` 将ico文件引入到 `index.html` 中，网站的图标就显示了

### 音乐播放器

使用 `h5` 的 `audio` 标签实现

默认不展示需要加上 contorls 属性展示音乐播放器的控件

### 基本布局

要先给js将路铺好！！！

比如这里将歌词列表的变化都在css中搞完：

1. 歌词的滚动效果
2. 歌词放大效果



#### 歌词滚动效果

> 关于 `text-align` 
>
> ​	将一个盒容器中的 **行盒/行块盒** 元素居中，并且可以被**继承**

1. 给一个容器设置固定的高度并且设置溢出隐藏
2. 歌词部分就在这个容器中搞一个竖块（高度要超出这个容器）
3. 然后只需要移动这个竖块就实现歌词滚动

![image-20230514111039319](C:/Desktop/everyday-study/%E5%AE%9E%E6%88%98-%E6%AD%8C%E8%AF%8D%E6%BB%9A%E5%8A%A8%E6%95%88%E6%9E%9C/images/image-20230514111039319.png)

> transition作用范围：
>
> ​	它只针对数值类的属性有效。比如`display:none;`就无效

#### 歌词放大效果

- 不要直接设置 `font-size` 去放大歌词，会影响到重新布局，并且可能伴随了意料之外的换行

- 使用 `transform: scale(1.1)` 实现放大，不影响主线程执行，效率高，不会有意料外的换行

这里也需要有过度效果，并且这个transform要一直存在（保障歌词放大缩小都有这个过渡效果）

![image-20230514113050303](C:/Desktop/everyday-study/%E5%AE%9E%E6%88%98-%E6%AD%8C%E8%AF%8D%E6%BB%9A%E5%8A%A8%E6%95%88%E6%9E%9C/images/image-20230514113050303.png)



### JS部分

1. 从数据出发

   > 现有数据是一串包含有时间节点的歌词字符串，不好处理
   >
   > 前端一般会将字符串 -> 数组/对象 处理

   将字符串转成一个数组 `[{time:number,words:string}]` 

   > 优先处理数据 这部分与页面无关 方便我们test测试和维护

2. 考虑数据对应功能

   后面歌词需要高亮，，我们就需要知道**哪句歌词要被高亮**

   > 只计算出当前高亮歌词的下标，具体偏移多少后面再说（纯函数）
   >
   > ​    audio标签元素中有一个 `currentTime` 属性可以知道目前播放的时间

```js
/**
 * 计算出当前播放到第几秒 对应高亮显示歌词的下标
 */
function findIndex() {
  const curTime = doms.audio.currentTime;
  return (
    lrcData.findIndex((item) => item.time > curTime) || lrcData, length - 1
  );
}
```



### 界面部分

1. 创建歌词li

   遍历歌词列表根据每句歌词创建 `li` 元素并且将它添加到 `ul` 中

   > 如果以后频繁去添加dom带来了效率问题 可以用 文档片段去优化

2. 设置ul的偏移

   ![image-20230514141627185](C:/Desktop/everyday-study/%E5%AE%9E%E6%88%98-%E6%AD%8C%E8%AF%8D%E6%BB%9A%E5%8A%A8%E6%95%88%E6%9E%9C/images/image-20230514141627185.png)
